{"version":3,"file":"learningobjectivesconfig.min.js","sources":["../src/learningobjectivesconfig.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the configuration of learning objectives.\n *\n * @module     mod_roadmap/learningobjectivesconfig\n * @copyright  2021 Steve Bader <smbader@ncsu.edu>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification', 'core/templates', 'mod_roadmap/cycle_save'],\n    function($, notification, templates, cyclesave) {\n\n        /**\n         * Learning objectives config object.\n         * @param {String} inputSelector The hidden input field selector.\n         * @param {String} inputConfig The hidden input field configuration.\n         */\n        var LearningObjectivesConfig = function(inputSelector, inputConfig) {\n            this.inputSelector = $(inputSelector);\n            this.configContainer = $(inputConfig);\n\n            this.showConfig(this);\n        };\n\n\n        /**\n         * Displays the learning objectives in a list.\n         *\n         * @method showConfig\n         */\n        LearningObjectivesConfig.prototype.showConfig = async function() {\n            var self = this;\n            var inputConfigVal = this.configContainer.val();\n            if (inputConfigVal === '') {\n                inputConfigVal = JSON.stringify({'learningobjectives': []});\n                this.configContainer.val(inputConfigVal);\n            }\n            var config = JSON.parse(inputConfigVal);\n            config.learningobjectives.forEach(function(learningobjective) {\n                learningobjective.number = learningobjective.index + 1;\n            });\n\n            try {\n                const {html, js} = await templates.renderForPromise('mod_roadmap/configuration_learningobjectives', config);\n                await templates.prependNodeContents(self.inputSelector, html, js);\n\n                $('#add-learning-objective').click(async function(e) {\n                    e.preventDefault();\n                    var nextloIndex = $('#learningobjective-container').children('.learningobjective').length;\n                    var newLo = {id: nextloIndex, number: nextloIndex + 1};\n                    try {\n                        const {html, js} = await templates.renderForPromise('mod_roadmap/configuration_learningobjective', newLo);\n                        await templates.appendNodeContents('#learningobjective-container', html, js);\n                        LearningObjectivesConfig.prototype.rebindInputs();\n                        LearningObjectivesConfig.prototype.saveConfig();\n                    } catch (err) {\n                        notification.exception(err);\n                    }\n                });\n\n                LearningObjectivesConfig.prototype.rebindInputs();\n            } catch (err) {\n                notification.exception(err);\n            }\n        };\n\n        LearningObjectivesConfig.prototype.rebindInputs = function() {\n            $('.learning-objective-name').unbind('change').change(function() {\n                LearningObjectivesConfig.prototype.saveConfig();\n            });\n            $('.learningobjective-delete-control').unbind('click').click(function(e) {\n                LearningObjectivesConfig.prototype.deleteLearningObjective(e);\n            });\n            $('.learningobjective-up-control').unbind('click').click(function(e) {\n                LearningObjectivesConfig.prototype.upLearningObjective(e);\n            });\n            $('.learningobjective-down-control').unbind('click').click(function(e) {\n                LearningObjectivesConfig.prototype.downLearningObjective(e);\n            });\n            $('input[name=\"cloprefix\"]').unbind('change').change(function() {\n                LearningObjectivesConfig.prototype.refreshChecklists();\n            });\n        };\n\n        LearningObjectivesConfig.prototype.saveConfig = function() {\n\n            var arrlo = [];\n            $('#learningobjective-container').children('.learningobjective').each(function(index) {\n                let lonode = $('#learningobjective-container').children('.learningobjective')[index];\n                let id = $(lonode).data('id');\n                let name = $(lonode).find('input.learning-objective-name').val();\n                $(lonode).find('span.number').html(index + 1);\n                arrlo.push({index: index, id: id, name: name});\n            });\n            $('input[name=\"learningobjectivesconfiguration\"]').val(JSON.stringify({learningobjectives: arrlo}));\n            LearningObjectivesConfig.prototype.refreshChecklists();\n            cyclesave.rebindInputs();\n\n            // Save any changes to the checklists\n            $('.chk-learning-objectives input[type=\"checkbox\"]').trigger('change');\n        };\n\n        LearningObjectivesConfig.prototype.refreshChecklists = function() {\n            var config = JSON.parse($('input[name=\"learningobjectivesconfiguration\"]').val());\n            var chkAreas = $('.chk-learning-objectives');\n\n            $(chkAreas).each(function(i, e) {\n                let selectedIds = [];\n                let configVal = $(this).closest('.cycle-container').children('.cycle-configuration').val();\n                if (configVal !== '') {\n                    // Get the configuration line from the local hidden field\n                    let stepConfig = JSON.parse(configVal);\n                    if (!stepConfig.learningobjectives) {\n                        stepConfig.learningobjectives = '';\n                    }\n                    selectedIds = stepConfig.learningobjectives.split(',').map(x => parseInt(x));\n                }\n\n                // Remove all inputs\n                $(e).empty();\n                let prefix = $('input[name=\"cloprefix\"]').val();\n\n                // Re-add inputs and remark any selected.\n                config.learningobjectives.forEach(function(learningobjective) {\n                    var li = $('<li/>').attr('data-id', learningobjective.id).appendTo($(e));\n                    $('<input/>').attr('type', 'checkbox').attr('value', learningobjective.id)\n                        .attr('class', 'form-control')\n                        .attr('checked', ($.inArray(learningobjective.id, selectedIds) >= 0)).appendTo(li);\n                    $('<span>').text(' ' + prefix + ' ' + (learningobjective.index + 1) + ': ' +\n                        learningobjective.name).appendTo(li);\n                });\n            });\n        };\n\n        LearningObjectivesConfig.prototype.deleteLearningObjective = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            notification.confirm(\n                'Are you sure you want to delete this Learning Objective?',\n                function() {\n                    var thisnode = $(event.currentTarget);\n                    var loItem = thisnode.closest('.learningobjective');\n                    loItem.remove();\n                    LearningObjectivesConfig.prototype.saveConfig();\n                }\n            );\n        };\n\n        LearningObjectivesConfig.prototype.upLearningObjective = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n\n            var thisnode = $(event.currentTarget);\n            var loItem = thisnode.closest('.learningobjective');\n            var prevloItem = loItem.prev();\n\n            loItem.insertBefore(prevloItem);\n            LearningObjectivesConfig.prototype.saveConfig();\n        };\n\n        LearningObjectivesConfig.prototype.downLearningObjective = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n\n            var thisnode = $(event.currentTarget);\n            var loItem = thisnode.closest('.learningobjective');\n            var nextloItem = loItem.next();\n\n            loItem.insertAfter(nextloItem);\n            LearningObjectivesConfig.prototype.saveConfig();\n        };\n\n        return {\n\n            /**\n             * Main initialisation.\n             *\n             * @param {String} inputSelector The hidden input field selector.\n             * @param {String} inputConfig The hidden input configuration.\n             * @return {LearningObjectivesConfig} A new instance of LearningObjectivesConfig.\n             * @method init\n             */\n            init: function(inputSelector, inputConfig) {\n                return new LearningObjectivesConfig(inputSelector, inputConfig);\n            },\n\n            refreshChecklists: function() {\n                LearningObjectivesConfig.prototype.refreshChecklists();\n            },\n        };\n    });\n"],"names":["define","$","notification","templates","cyclesave","LearningObjectivesConfig","inputSelector","inputConfig","configContainer","showConfig","this","prototype","async","inputConfigVal","val","JSON","stringify","config","parse","learningobjectives","forEach","learningobjective","number","index","html","js","renderForPromise","prependNodeContents","click","e","preventDefault","nextloIndex","children","length","newLo","id","appendNodeContents","rebindInputs","saveConfig","err","exception","unbind","change","deleteLearningObjective","upLearningObjective","downLearningObjective","refreshChecklists","arrlo","each","lonode","data","name","find","push","trigger","chkAreas","i","selectedIds","configVal","closest","stepConfig","split","map","x","parseInt","empty","prefix","li","attr","appendTo","inArray","text","event","stopPropagation","confirm","currentTarget","remove","loItem","prevloItem","prev","insertBefore","nextloItem","next","insertAfter","init"],"mappings":"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"}