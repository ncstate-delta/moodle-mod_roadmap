{"version":3,"sources":["../src/step_activity_select.js"],"names":["define","$","notification","templates","ajax","Dialogue","StepActivitySelector","prototype","rebind_checkbox","unbind","each","index","chk","stepid","data","prop","click","input","configure_checkbox","multipleActivities","val","split","length","rebind_buttons","showConfig","bind","event","self","activityData","JSON","parse","clickedButton","target","render","done","html","initActivityConfig","fail","exception","popup","body","getContent","on","values","toArray","map","item","value","join","text","stepId","children","remove","append","trigger","close","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle opening a dialogue to configure scale data.\n *\n * @module     mod_roadmap/stepactivityselect\n * @package    mod_roadmap\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification', 'core/templates', 'core/ajax', 'mod_roadmap/dialogue'],\n    function($, notification, templates, ajax, Dialogue) {\n\n        var StepActivitySelector = function() {\n\n        };\n\n        StepActivitySelector.prototype.rebind_checkbox = function() {\n            $('.chk-single-activity-link').unbind('click').each(function(index, chk) {\n                let stepid = $(chk).data('stepid');\n                $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", $(chk).prop('checked'));\n\n                $(chk).click(function() {\n                    let stepid = $(this).data('stepid');\n                    $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", $(this).prop('checked'));\n                });\n            });\n\n            $('.completion-modules').unbind('change').each(function(index, input) {\n                StepActivitySelector.prototype.configure_checkbox(input);\n            });\n        };\n\n        StepActivitySelector.prototype.configure_checkbox = function(input) {\n            let stepid = $(input).data('stepid');\n            let multipleActivities = ($('#step-' + stepid + '-completion-modules').val().split(',').length > 1);\n\n            $('#step-' + stepid + '-chk-single-activity-link').prop(\"disabled\", multipleActivities);\n            if (multipleActivities) {\n                $('#step-' + stepid + '-chk-single-activity-link').prop(\"checked\", !multipleActivities);\n                $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", !multipleActivities);\n            }\n        };\n\n        StepActivitySelector.prototype.rebind_buttons = function() {\n            $('.btn_completion_selector').unbind('click').click(this.showConfig.bind(this));\n        };\n\n        StepActivitySelector.prototype.showConfig = function(event) {\n            var self = this;\n            var activityData = JSON.parse($('input[name=\"activity_data\"]').val());\n            self.clickedButton = event.target;\n\n            // Dish up the form.\n            templates.render('mod_roadmap/configuration_activityselect', activityData)\n                .done(function(html) {\n                    new Dialogue(\n                        'Select Activities for Step Completion',\n                        html,\n                        self.initActivityConfig.bind(self)\n                    );\n                }).fail(notification.exception);\n        };\n\n        StepActivitySelector.prototype.initActivityConfig = function(popup) {\n            this.popup = popup;\n            var body = $(popup.getContent());\n            //if (this.originalscaleid === this.scaleid) {\n\n            //}\n            body.on('click', '[data-action=\"save\"]', function() {\n                let values = $('#step-activity-selector option:selected').toArray()\n                        .map(item => item.value).join(',');\n                let text = $('#step-activity-selector option:selected').toArray()\n                        .map(item => '<li>' + item.text + '</li>').join('');\n\n                let stepId = $(this.clickedButton).data('stepid');\n                $('input[name=\"step-' + stepId + '-completion-modules\"]').val(values);\n                StepActivitySelector.prototype.configure_checkbox($('input[name=\"step-' + stepId + '-completion-modules\"]'));\n\n                $('#step-' + stepId + '-completion-list').children('li').remove();\n                $('#step-' + stepId + '-completion-list').append(text).trigger('change');\n                popup.close();\n            }.bind(this));\n            body.on('click', '[data-action=\"cancel\"]', function() {\n                popup.close();\n            });\n        };\n\n        return {\n\n            /**\n             * Main initialisation.\n             *\n             * @param {String} selectSelector The select box selector.\n             * @param {String} inputSelector The hidden input field selector.\n             * @param {String} triggerSelector The trigger selector.\n             * @return {ScaleConfig} A new instance of ScaleConfig.\n             * @method init\n             */\n            init: function() {\n                return new StepActivitySelector();\n            },\n\n            rebind_buttons: function() {\n                StepActivitySelector.prototype.rebind_buttons();\n                StepActivitySelector.prototype.rebind_checkbox();\n            }\n        };\n    });"],"file":"step_activity_select.min.js"}