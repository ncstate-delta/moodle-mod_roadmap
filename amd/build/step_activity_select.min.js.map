{"version":3,"file":"step_activity_select.min.js","sources":["../src/step_activity_select.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle opening a dialogue to configure scale data.\n *\n * @module     mod_roadmap/stepactivityselect\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification', 'core/templates', 'core/ajax', 'mod_roadmap/dialogue',\n        'mod_roadmap/step_save'],\n    function($, notification, templates, ajax, Dialogue, stepsave) {\n\n        var StepActivitySelector = function() {\n            // Do nothing.\n        };\n\n        StepActivitySelector.prototype.rebindCheckbox = function() {\n            $('.chk-single-activity-link').unbind('click').each(function(index, chk) {\n                let stepid = $(chk).data('stepid');\n                $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", $(chk).prop('checked'));\n\n                $(chk).click(function() {\n                    let stepid = $(this).data('stepid');\n                    $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", $(this).prop('checked'));\n                });\n            });\n\n            $('.completion-modules').unbind('change').each(function(index, input) {\n                StepActivitySelector.prototype.configureCheckbox(input);\n            });\n        };\n\n        StepActivitySelector.prototype.configureCheckbox = function(input) {\n            let stepid = $(input).data('stepid');\n            let multipleActivities = ($('#step-' + stepid + '-completion-modules').val().split(',').length > 1);\n\n            $('#step-' + stepid + '-chk-single-activity-link').prop(\"disabled\", multipleActivities);\n            if (multipleActivities) {\n                $('#step-' + stepid + '-chk-single-activity-link').prop(\"checked\", !multipleActivities);\n                $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", !multipleActivities);\n            }\n        };\n\n        StepActivitySelector.prototype.rebindButtons = function() {\n            $('.btn_completion_selector').unbind('click').click(this.showConfig.bind(this));\n        };\n\n        StepActivitySelector.prototype.showConfig = function(event) {\n            var self = this;\n            var activityData = JSON.parse($('input[name=\"activity_data\"]').val());\n            self.clickedButton = event.target;\n\n            // Dish up the form.\n            templates.render('mod_roadmap/configuration_activityselect', activityData)\n                .done(function(html) {\n                    new Dialogue(\n                        'Select Activities for Step Completion',\n                        html,\n                        self.initActivityConfig.bind(self)\n                    );\n                }).fail(notification.exception);\n        };\n\n        StepActivitySelector.prototype.loadList = function() {\n            var activityData = JSON.parse($('input[name=\"activity_data\"]').val());\n            var listAreas = $('ul.step-completion-list');\n\n            $(listAreas).each(function(i, e) {\n\n                // Get the configuration line from the local hidden field\n                var stepCompletionModules = $(this).closest('.step-activity-container').find('.step-completion-modules').val();\n                var selectedIds = stepCompletionModules.split(',');\n\n                $(e).children('li').remove();\n                // Use the selected ids to get course module information\n                activityData.activities.forEach(function(activity) {\n                    if ($.inArray(activity.coursemoduleid, selectedIds) >= 0) {\n                        var li = $('<li/>').attr('data-id', activity.coursemoduleid).appendTo($(e));\n                        $('<span>').text(activity.name).appendTo(li);\n                        $(e).append(li);\n                    }\n                });\n\n                $(e).trigger('change');\n                StepActivitySelector.prototype.configureCheckbox(\n                    $(this).closest('.step-activity-container').find('.step-completion-modules'));\n            });\n\n        };\n\n        StepActivitySelector.prototype.initActivityConfig = function(popup) {\n            this.popup = popup;\n            var body = $(popup.getContent());\n\n            body.on('click', '[data-action=\"save\"]', function() {\n                let values = $('#step-activity-selector option:selected').toArray()\n                        .map(item => item.value).join(',');\n\n                let stepId = $(this.clickedButton).data('stepid');\n                $('#step-' + stepId + '-completion-modules').val(values).trigger('change');\n\n                StepActivitySelector.prototype.loadList();\n                stepsave.rebindInputs();\n                popup.close();\n            }.bind(this));\n            body.on('click', '[data-action=\"cancel\"]', function() {\n                popup.close();\n            });\n        };\n\n        return {\n\n            /**\n             * Main initialisation.\n             *\n             * @return {ScaleConfig} A new instance of ScaleConfig.\n             * @method init\n             */\n            init: function() {\n                return new StepActivitySelector();\n            },\n\n            rebindButtons: function() {\n                StepActivitySelector.prototype.rebindButtons();\n                StepActivitySelector.prototype.rebindCheckbox();\n                StepActivitySelector.prototype.loadList();\n            }\n        };\n    });"],"names":["define","$","notification","templates","ajax","Dialogue","stepsave","StepActivitySelector","prototype","rebindCheckbox","unbind","each","index","chk","stepid","data","prop","click","this","input","configureCheckbox","multipleActivities","val","split","length","rebindButtons","showConfig","bind","event","self","activityData","JSON","parse","clickedButton","target","render","done","html","initActivityConfig","fail","exception","loadList","listAreas","i","e","selectedIds","closest","find","children","remove","activities","forEach","activity","inArray","coursemoduleid","li","attr","appendTo","text","name","append","trigger","popup","body","getContent","on","values","toArray","map","item","value","join","stepId","rebindInputs","close","init"],"mappings":"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"}