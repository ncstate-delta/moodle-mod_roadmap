{"version":3,"sources":["../src/step_activity_select.js"],"names":["define","$","notification","templates","ajax","Dialogue","stepsave","StepActivitySelector","prototype","rebind_checkbox","unbind","each","index","chk","stepid","data","prop","click","input","configure_checkbox","multipleActivities","val","split","length","rebind_buttons","showConfig","bind","event","self","activityData","JSON","parse","clickedButton","target","render","done","html","initActivityConfig","fail","exception","loadList","listAreas","i","e","stepCompletionModules","closest","find","selectedIds","children","remove","activities","forEach","activity","inArray","coursemoduleid","li","attr","appendTo","text","name","append","trigger","popup","body","getContent","on","values","toArray","map","item","value","join","stepId","rebind_inputs","close","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle opening a dialogue to configure scale data.\n *\n * @module     mod_roadmap/stepactivityselect\n * @package    mod_roadmap\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification', 'core/templates', 'core/ajax', 'mod_roadmap/dialogue',\n        'mod_roadmap/step_save'],\n    function($, notification, templates, ajax, Dialogue, stepsave) {\n\n        var StepActivitySelector = function() {\n\n        };\n\n        StepActivitySelector.prototype.rebind_checkbox = function() {\n            $('.chk-single-activity-link').unbind('click').each(function(index, chk) {\n                let stepid = $(chk).data('stepid');\n                $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", $(chk).prop('checked'));\n\n                $(chk).click(function() {\n                    let stepid = $(this).data('stepid');\n                    $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", $(this).prop('checked'));\n                });\n            });\n\n            $('.completion-modules').unbind('change').each(function(index, input) {\n                StepActivitySelector.prototype.configure_checkbox(input);\n            });\n        };\n\n        StepActivitySelector.prototype.configure_checkbox = function(input) {\n            let stepid = $(input).data('stepid');\n            let multipleActivities = ($('#step-' + stepid + '-completion-modules').val().split(',').length > 1);\n\n            $('#step-' + stepid + '-chk-single-activity-link').prop(\"disabled\", multipleActivities);\n            if (multipleActivities) {\n                $('#step-' + stepid + '-chk-single-activity-link').prop(\"checked\", !multipleActivities);\n                $('#step-' + stepid + '-single-activity-link').prop(\"disabled\", !multipleActivities);\n            }\n        };\n\n        StepActivitySelector.prototype.rebind_buttons = function() {\n            $('.btn_completion_selector').unbind('click').click(this.showConfig.bind(this));\n        };\n\n        StepActivitySelector.prototype.showConfig = function(event) {\n            var self = this;\n            var activityData = JSON.parse($('input[name=\"activity_data\"]').val());\n            self.clickedButton = event.target;\n\n            // Dish up the form.\n            templates.render('mod_roadmap/configuration_activityselect', activityData)\n                .done(function(html) {\n                    new Dialogue(\n                        'Select Activities for Step Completion',\n                        html,\n                        self.initActivityConfig.bind(self)\n                    );\n                }).fail(notification.exception);\n        };\n\n        StepActivitySelector.prototype.loadList = function() {\n            var activityData = JSON.parse($('input[name=\"activity_data\"]').val());\n            var listAreas = $('ul.step-completion-list');\n\n            $(listAreas).each(function(i, e) {\n\n                // get the configuration line from the local hidden field\n                //let stepConfig = JSON.parse($(this).closest('.step-container').children('.step-configuration').val());\n                var stepCompletionModules = $(this).closest('.step-activity-container').find('.step-completion-modules').val();\n                var selectedIds = stepCompletionModules.split(',');\n\n                $(e).children('li').remove();\n                // Use the selected ids to get course module information\n                activityData.activities.forEach(function (activity) {\n                    if ($.inArray(activity.coursemoduleid, selectedIds)>=0) {\n                        var li = $('<li/>').attr('data-id', activity.coursemoduleid).appendTo($(e));\n                        $('<span>').text(activity.name).appendTo(li);\n                        $(e).append(li);\n                    }\n                });\n\n                $(e).trigger('change');\n                StepActivitySelector.prototype.configure_checkbox(\n                    $(this).closest('.step-activity-container').find('.step-completion-modules'));\n            });\n\n        };\n\n        StepActivitySelector.prototype.initActivityConfig = function(popup) {\n            this.popup = popup;\n            var body = $(popup.getContent());\n\n            body.on('click', '[data-action=\"save\"]', function() {\n                let values = $('#step-activity-selector option:selected').toArray()\n                        .map(item => item.value).join(',');\n\n                let stepId = $(this.clickedButton).data('stepid');\n                $('#step-' + stepId + '-completion-modules').val(values).trigger('change');\n\n                StepActivitySelector.prototype.loadList();\n                stepsave.rebind_inputs();\n                popup.close();\n            }.bind(this));\n            body.on('click', '[data-action=\"cancel\"]', function() {\n                popup.close();\n            });\n        };\n\n        return {\n\n            /**\n             * Main initialisation.\n             *\n             * @param {String} selectSelector The select box selector.\n             * @param {String} inputSelector The hidden input field selector.\n             * @param {String} triggerSelector The trigger selector.\n             * @return {ScaleConfig} A new instance of ScaleConfig.\n             * @method init\n             */\n            init: function() {\n                return new StepActivitySelector();\n            },\n\n            rebind_buttons: function() {\n                StepActivitySelector.prototype.rebind_buttons();\n                StepActivitySelector.prototype.rebind_checkbox();\n                StepActivitySelector.prototype.loadList();\n            }\n        };\n    });"],"file":"step_activity_select.min.js"}