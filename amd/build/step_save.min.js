/**
 * Handle the saving of step data and rebinding of inputs.
 *
 * @module     mod_roadmap/step_save
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_roadmap/step_save",["jquery"],(function($){const instance=new class{rebindInputs(){$(".roadmap-form-control-step").off("change").on("change",this.saveStep.bind(this)),this.loadList(),$(".step-container").each(((_,el)=>{this.saveStep({target:el})}))}loadList(){const activityData=JSON.parse($('input[name="activity_data"]').val()||"{}");$("ul.step-completion-list").each((function(){const $list=$(this),selectedIds=($list.closest(".step-activity-container").find(".step-completion-modules").val()||"").split(",").filter((x=>x));$list.empty(),activityData.activities&&Array.isArray(activityData.activities)&&activityData.activities.forEach((function(activity){if(selectedIds.includes(activity.id)){const li=$("<li/>").attr("data-id",activity.id);$("<span>").text(activity.name).appendTo(li),$list.append(li)}}));const singleActivitySection=$(this).closest(".step-container").find(".single-activity-link-container"),linkPageContainer=$(this).closest(".step-container").find(".link-to-page-container");if(1===selectedIds.length){singleActivitySection.show();($(this).closest(".step-container").find(".fitem input.chk-single-activity-link").prop("checked")?1:0)?linkPageContainer.show():linkPageContainer.hide()}else singleActivitySection.hide(),linkPageContainer.hide()}))}saveStep(event){const $stepContainer=$(event.target).closest(".step-container");this.updateLinkToPage(event);const linksingleactivity=$stepContainer.find(".fitem input.chk-single-activity-link").prop("checked")?1:0,rollovertext=$stepContainer.find(".fitem input.step-rollovertext").val(),stepData={id:$stepContainer.closest(".step-wrapper").data("stepid"),rollovertext:rollovertext,stepicon:$stepContainer.find(".fitem input.step-icon").val(),completionmodules:$stepContainer.find(".fitem input.step-completion-modules").val(),linksingleactivity:linksingleactivity,pagelink:$stepContainer.find(".fitem input.step-single-activity-link").val(),completionexpectedcmid:$stepContainer.find(".fitem input.expectedcomplete-coursemoduleid").val(),completionexpecteddatetime:$stepContainer.find(".fitem input.expectedcomplete-datetime").val()};$stepContainer.closest(".step-wrapper").find(".step-header-title").html(rollovertext),$stepContainer.children("input.step-configuration").val(JSON.stringify(stepData)).triggerHandler("change")}updateLinkToPage(event){const stepContainer=$(event.target).closest(".step-container"),linksingleactivity=stepContainer.find(".fitem input.chk-single-activity-link").prop("checked")?1:0,linkPageContainer=stepContainer.find(".link-to-page-container");linksingleactivity?linkPageContainer.show():linkPageContainer.hide()}};return{init:function(){return instance},rebindInputs:function(){instance.rebindInputs()}}}));

//# sourceMappingURL=step_save.min.js.map