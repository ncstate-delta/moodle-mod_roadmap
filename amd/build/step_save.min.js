/**
 * Handle the saving of step data and rebinding of inputs.
 *
 * @module     mod_roadmap/step_save
 * @copyright  2021 Steve Bader <smbader@ncsu.edu>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_roadmap/step_save",["jquery"],(function($){const instance=new class{rebindInputs(){$(".roadmap-form-control-step").off("change").on("change",this.saveStep.bind(this)),this.loadList(),$(".step-container").each(((_,el)=>{this.saveStep({target:el})}))}loadList(){const activityData=JSON.parse($('input[name="activity_data"]').val()||"{}");$("ul.step-completion-list").each(((_,el)=>{const list=$(el),selectedIds=(list.closest(".step-activity-container").find(".step-completion-modules").val()||"").split(",").filter((x=>x));list.empty(),activityData.activities&&Array.isArray(activityData.activities)&&activityData.activities.forEach((function(activity){if(selectedIds.includes(activity.id)){const li=$("<li/>").attr("data-id",activity.id);$("<span>").text(activity.name).appendTo(li),list.append(li)}})),this.updateLinkToPage(list.closest(".step-container"))}))}saveStep(event){const stepContainer=$(event.target).closest(".step-container");this.updateLinkToPage(stepContainer);const linksingleactivity=stepContainer.find(".fitem input.chk-single-activity-link").prop("checked")?1:0,rollovertext=stepContainer.find(".fitem input.step-rollovertext").val(),stepData={id:stepContainer.closest(".step-wrapper").data("stepid"),rollovertext:rollovertext,stepicon:stepContainer.find(".fitem input.step-icon").val(),completionmodules:stepContainer.find(".fitem input.step-completion-modules").val(),linksingleactivity:linksingleactivity,pagelink:stepContainer.find(".fitem input.step-single-activity-link").val(),completionexpectedcmid:stepContainer.find(".fitem input.expectedcomplete-coursemoduleid").val(),completionexpecteddatetime:stepContainer.find(".fitem input.expectedcomplete-datetime").val()};stepContainer.closest(".step-wrapper").find(".step-header-title").html(rollovertext),stepContainer.children("input.step-configuration").val(JSON.stringify(stepData)).triggerHandler("change")}updateLinkToPage(stepContainer){const singleActivitySection=stepContainer.find(".single-activity-link-container"),linkPageContainer=stepContainer.find(".link-to-page-container"),chkSingleActivity=stepContainer.find(".fitem input.chk-single-activity-link");1===(stepContainer.find(".step-completion-modules").val()||"").split(",").filter((x=>x)).length?(singleActivitySection.show(),chkSingleActivity.prop("checked")?linkPageContainer.hide():linkPageContainer.show()):(chkSingleActivity.prop("checked",!1),singleActivitySection.hide(),linkPageContainer.show())}};return{init:function(){return instance},rebindInputs:function(){instance.rebindInputs()}}}));

//# sourceMappingURL=step_save.min.js.map