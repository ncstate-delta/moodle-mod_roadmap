/**
 * Handle the saving of step data and rebinding of inputs.
 *
 * @module     mod_roadmap/stepsave
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_roadmap/step_save",["jquery"],(function($){var StepSave=function(){};return StepSave.prototype.rebindInputs=function(){$(".roadmap-form-control-step").unbind("change").change(this.saveStep.bind(this)),StepSave.prototype.loadList(),StepSave.prototype.saveStep(this)},StepSave.prototype.loadList=function(){var activityData=JSON.parse($('input[name="activity_data"]').val()),listAreas=$("ul.step-completion-list");$(listAreas).each((function(i,e){var selectedIds=$(this).closest(".step-activity-container").find(".step-completion-modules").val().split(",");$(e).children("li").remove(),activityData.activities.forEach((function(activity){if($.inArray(activity.id,selectedIds)>=0){var li=$("<li/>").attr("data-id",activity.id).appendTo($(e));$("<span>").text(activity.name).appendTo(li),$(e).append(li)}}))}))},StepSave.prototype.saveStep=function(event){var stepContainer=$(event.target).closest(".step-container"),linksingleactivity=0;1==stepContainer.find(".fitem input.chk-single-activity-link").prop("checked")&&(linksingleactivity=1);let rollovertext=stepContainer.find(".fitem input.step-rollovertext").val();var stepData={id:stepContainer.closest(".step-wrapper").data("stepid"),rollovertext:rollovertext,stepicon:stepContainer.find(".fitem input.step-icon").val(),completionmodules:stepContainer.find(".fitem input.step-completion-modules").val(),linksingleactivity:linksingleactivity,pagelink:stepContainer.find(".fitem input.step-single-activity-link").val(),completionexpectedcmid:stepContainer.find(".fitem input.expectedcomplete-coursemoduleid").val(),completionexpecteddatetime:stepContainer.find(".fitem input.expectedcomplete-datetime").val()};stepContainer.closest(".step-wrapper").find(".step-header-title").html(rollovertext),stepContainer.children("input.step-configuration").val(JSON.stringify(stepData)).triggerHandler("change")},{init:function(){return new StepSave},rebindInputs:function(){StepSave.prototype.rebindInputs()}}}));

//# sourceMappingURL=step_save.min.js.map