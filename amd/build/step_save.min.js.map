{"version":3,"file":"step_save.min.js","sources":["../src/step_save.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle opening a dialogue to configure scale data.\n *\n * @module     mod_roadmap/stepsave\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'],\n    function($) {\n\n        var StepSave = function() {\n            // Do nothing.\n        };\n\n        StepSave.prototype.rebindInputs = function() {\n            // Rebind any new fields with save step on change.\n            $('.roadmap-form-control-step')\n                .unbind('change')\n                .change(this.saveStep.bind(this));\n\n            // Run save step if a new field has been added.\n            StepSave.prototype.loadList();\n            StepSave.prototype.saveStep(this);\n        };\n\n        StepSave.prototype.loadList = function() {\n            var activityData = JSON.parse($('input[name=\"activity_data\"]').val());\n            var listAreas = $('ul.step-completion-list');\n\n            $(listAreas).each(function(i, e) {\n\n                // Get the configuration line from the local hidden field\n                var stepCompletionModules = $(this).closest('.step-activity-container').find('.step-completion-modules').val();\n                var selectedIds = stepCompletionModules.split(',');\n\n                $(e).children('li').remove();\n                // Use the selected ids to get course module information\n                activityData.activities.forEach(function(activity) {\n                    if ($.inArray(activity.id, selectedIds) >= 0) {\n                        var li = $('<li/>').attr('data-id', activity.id).appendTo($(e));\n                        $('<span>').text(activity.name).appendTo(li);\n                        $(e).append(li);\n                    }\n                });\n            });\n        };\n\n        StepSave.prototype.saveStep = function(event) {\n            // Find step container that we are saving data from.\n            var stepContainer = $(event.target).closest('.step-container');\n\n            // Link single activity check box option.\n            var linksingleactivity = 0;\n            if (stepContainer.find('.fitem input.chk-single-activity-link').prop(\"checked\") == true) {\n                linksingleactivity = 1;\n            }\n\n            // Save rollover text and use to set the step header title.\n            let rollovertext = stepContainer.find('.fitem input.step-rollovertext').val();\n\n            // Step data object collection.\n            var stepData = {\n                id: stepContainer.closest('.step-wrapper').data('stepid'),\n                rollovertext: rollovertext,\n                stepicon: stepContainer.find('.fitem input.step-icon').val(),\n                completionmodules: stepContainer.find('.fitem input.step-completion-modules').val(),\n                linksingleactivity: linksingleactivity,\n                pagelink: stepContainer.find('.fitem input.step-single-activity-link').val(),\n                completionexpectedcmid: stepContainer.find('.fitem input.expectedcomplete-coursemoduleid').val(),\n                completionexpecteddatetime: stepContainer.find('.fitem input.expectedcomplete-datetime').val(),\n            };\n\n            // Set the header title with the new step roll over text and save the step data object as json to config.\n            stepContainer.closest('.step-wrapper').find('.step-header-title').html(rollovertext);\n            stepContainer.children('input.step-configuration').val(JSON.stringify(stepData)).triggerHandler(\"change\");\n        };\n\n        return {\n            init: function() {\n                return new StepSave();\n            },\n\n            rebindInputs: function() {\n                StepSave.prototype.rebindInputs();\n            }\n        };\n    });"],"names":["define","$","StepSave","prototype","rebindInputs","unbind","change","this","saveStep","bind","loadList","activityData","JSON","parse","val","listAreas","each","i","e","selectedIds","closest","find","split","children","remove","activities","forEach","activity","inArray","id","li","attr","appendTo","text","name","append","event","stepContainer","target","linksingleactivity","prop","rollovertext","stepData","data","stepicon","completionmodules","pagelink","completionexpectedcmid","completionexpecteddatetime","html","stringify","triggerHandler","init"],"mappings":";;;;;;AAqBAA,+BAAO,CAAC,WACJ,SAASC,OAEDC,SAAW,oBAIfA,SAASC,UAAUC,aAAe,WAE9BH,EAAE,8BACGI,OAAO,UACPC,OAAOC,KAAKC,SAASC,KAAKF,OAG/BL,SAASC,UAAUO,WACnBR,SAASC,UAAUK,SAASD,OAGhCL,SAASC,UAAUO,SAAW,eACtBC,aAAeC,KAAKC,MAAMZ,EAAE,+BAA+Ba,OAC3DC,UAAYd,EAAE,2BAElBA,EAAEc,WAAWC,MAAK,SAASC,EAAGC,OAItBC,YADwBlB,EAAEM,MAAMa,QAAQ,4BAA4BC,KAAK,4BAA4BP,MACjEQ,MAAM,KAE9CrB,EAAEiB,GAAGK,SAAS,MAAMC,SAEpBb,aAAac,WAAWC,SAAQ,SAASC,aACjC1B,EAAE2B,QAAQD,SAASE,GAAIV,cAAgB,EAAG,KACtCW,GAAK7B,EAAE,SAAS8B,KAAK,UAAWJ,SAASE,IAAIG,SAAS/B,EAAEiB,IAC5DjB,EAAE,UAAUgC,KAAKN,SAASO,MAAMF,SAASF,IACzC7B,EAAEiB,GAAGiB,OAAOL,YAM5B5B,SAASC,UAAUK,SAAW,SAAS4B,WAE/BC,cAAgBpC,EAAEmC,MAAME,QAAQlB,QAAQ,mBAGxCmB,mBAAqB,EAC0D,GAA/EF,cAAchB,KAAK,yCAAyCmB,KAAK,aACjED,mBAAqB,OAIrBE,aAAeJ,cAAchB,KAAK,kCAAkCP,UAGpE4B,SAAW,CACXb,GAAIQ,cAAcjB,QAAQ,iBAAiBuB,KAAK,UAChDF,aAAcA,aACdG,SAAUP,cAAchB,KAAK,0BAA0BP,MACvD+B,kBAAmBR,cAAchB,KAAK,wCAAwCP,MAC9EyB,mBAAoBA,mBACpBO,SAAUT,cAAchB,KAAK,0CAA0CP,MACvEiC,uBAAwBV,cAAchB,KAAK,gDAAgDP,MAC3FkC,2BAA4BX,cAAchB,KAAK,0CAA0CP,OAI7FuB,cAAcjB,QAAQ,iBAAiBC,KAAK,sBAAsB4B,KAAKR,cACvEJ,cAAcd,SAAS,4BAA4BT,IAAIF,KAAKsC,UAAUR,WAAWS,eAAe,WAG7F,CACHC,KAAM,kBACK,IAAIlD,UAGfE,aAAc,WACVF,SAASC,UAAUC"}