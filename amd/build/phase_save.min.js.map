{"version":3,"file":"phase_save.min.js","sources":["../src/phase_save.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the saving of phase data and rebinding of inputs.\n *\n * @module     mod_roadmap/phase_save\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    /**\n     * PhaseSave class handles saving and rebinding for roadmap phases.\n     * @class\n     */\n    class PhaseSave {\n        /**\n         * Rebinds all inputs related to phase and attaches save handlers.\n         */\n        rebindInputs() {\n            $('.phase-title').off('change').on('change', this.savePhase.bind(this));\n            $('.phase-cycles-container .cycle-wrapper .cycle-configuration')\n                .off('change').on('change', this.savePhase.bind(this));\n            // Initial save for all phases (for new fields added)\n            $('.phase-container').each((_, el) => {\n                this.savePhase({target: el});\n            });\n        }\n\n        /**\n         * Saves the phase data to its hidden config input.\n         * @param {Event|Object} event Event or jQuery-wrapped element reference.\n         */\n        savePhase(event) {\n            // Support both event and direct call with element\n            const $phaseContainer = $(event.target).closest('.phase-container');\n            const phaseCycles = [];\n            let index = 0;\n            $phaseContainer.find('.phase-cycles-container .cycle-wrapper .cycle-configuration').each(function() {\n                let cycleData = $(this).val() || '{}';\n                let cycleDataObj = JSON.parse(cycleData);\n                cycleDataObj.index = index++;\n                phaseCycles.push(cycleDataObj);\n            });\n            const title = $phaseContainer.find('.fitem input.phase-title').val();\n            const phaseData = {\n                id: $phaseContainer.closest('.phase-wrapper').data('phaseid'),\n                title: title,\n                cycles: phaseCycles,\n            };\n            $phaseContainer.closest('.phase-wrapper').find('.phase-header-title').html(title);\n            $phaseContainer.children('input.phase-configuration')\n                .val(JSON.stringify(phaseData)).triggerHandler(\"change\");\n        }\n    }\n\n    // AMD export\n    const instance = new PhaseSave();\n    return {\n        /**\n         * Initialize PhaseSave (returns instance).\n         * @returns {PhaseSave}\n         */\n        init: function() { return instance; },\n        /**\n         * Rebinds all phase input handlers.\n         */\n        rebindInputs: function() { instance.rebindInputs(); }\n    };\n});"],"names":["define","$","instance","rebindInputs","off","on","this","savePhase","bind","each","_","el","target","event","$phaseContainer","closest","phaseCycles","index","find","cycleData","val","cycleDataObj","JSON","parse","push","title","phaseData","id","data","cycles","html","children","stringify","triggerHandler","init"],"mappings":";;;;;;AAqBAA,gCAAO,CAAC,WAAW,SAASC,SA+ClBC,SAAW,UAtCbC,eACIF,EAAE,gBAAgBG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OACjEL,EAAE,+DACGG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OAEpDL,EAAE,oBAAoBQ,MAAK,CAACC,EAAGC,WACtBJ,UAAU,CAACK,OAAQD,QAQhCJ,UAAUM,aAEAC,gBAAkBb,EAAEY,MAAMD,QAAQG,QAAQ,oBAC1CC,YAAc,OAChBC,MAAQ,EACZH,gBAAgBI,KAAK,+DAA+DT,MAAK,eACjFU,UAAYlB,EAAEK,MAAMc,OAAS,KAC7BC,aAAeC,KAAKC,MAAMJ,WAC9BE,aAAaJ,MAAQA,QACrBD,YAAYQ,KAAKH,uBAEfI,MAAQX,gBAAgBI,KAAK,4BAA4BE,MACzDM,UAAY,CACdC,GAAIb,gBAAgBC,QAAQ,kBAAkBa,KAAK,WACnDH,MAAOA,MACPI,OAAQb,aAEZF,gBAAgBC,QAAQ,kBAAkBG,KAAK,uBAAuBY,KAAKL,OAC3EX,gBAAgBiB,SAAS,6BACpBX,IAAIE,KAAKU,UAAUN,YAAYO,eAAe,kBAMpD,CAKHC,KAAM,kBAAoBhC,UAI1BC,aAAc,WAAaD,SAASC"}