/**
 * Handle opening a dialogue to configure scale data.
 *
 * @module     mod_roadmap/stepactivityselect
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_roadmap/step_activity_select",["jquery","core/notification","core/templates","core/ajax","mod_roadmap/dialogue","mod_roadmap/step_save"],(function($,notification,templates,ajax,Dialogue,stepsave){var StepActivitySelector=function(){};return StepActivitySelector.prototype.rebindCheckbox=function(){$(".chk-single-activity-link").unbind("click").each((function(index,chk){let stepid=$(chk).data("stepid");$("#step-"+stepid+"-single-activity-link").prop("disabled",$(chk).prop("checked")),$(chk).click((function(){let stepid=$(this).data("stepid");$("#step-"+stepid+"-single-activity-link").prop("disabled",$(this).prop("checked"))}))})),$(".completion-modules").unbind("change").each((function(index,input){StepActivitySelector.prototype.configureCheckbox(input)}))},StepActivitySelector.prototype.configureCheckbox=function(input){let stepid=$(input).data("stepid"),multipleActivities=$("#step-"+stepid+"-completion-modules").val().split(",").length>1;$("#step-"+stepid+"-chk-single-activity-link").prop("disabled",multipleActivities),multipleActivities&&($("#step-"+stepid+"-chk-single-activity-link").prop("checked",!multipleActivities),$("#step-"+stepid+"-single-activity-link").prop("disabled",!multipleActivities))},StepActivitySelector.prototype.rebindButtons=function(){$(".btn_completion_selector").unbind("click").click(this.showConfig.bind(this))},StepActivitySelector.prototype.showConfig=function(event){var self=this,activityData=JSON.parse($('input[name="activity_data"]').val());self.clickedButton=event.target,templates.render("mod_roadmap/configuration_activityselect",activityData).done((function(html){new Dialogue("Select Activities for Step Completion",html,self.initActivityConfig.bind(self))})).fail(notification.exception)},StepActivitySelector.prototype.loadList=function(){var activityData=JSON.parse($('input[name="activity_data"]').val()),listAreas=$("ul.step-completion-list");$(listAreas).each((function(i,e){var selectedIds=$(this).closest(".step-activity-container").find(".step-completion-modules").val().split(",");$(e).children("li").remove(),activityData.activities.forEach((function(activity){if($.inArray(activity.coursemoduleid,selectedIds)>=0){var li=$("<li/>").attr("data-id",activity.coursemoduleid).appendTo($(e));$("<span>").text(activity.name).appendTo(li),$(e).append(li)}})),$(e).trigger("change"),StepActivitySelector.prototype.configureCheckbox($(this).closest(".step-activity-container").find(".step-completion-modules"))}))},StepActivitySelector.prototype.initActivityConfig=function(popup){this.popup=popup;var body=$(popup.getContent());body.on("click",'[data-action="save"]',function(){let values=$("#step-activity-selector option:selected").toArray().map((item=>item.value)).join(","),stepId=$(this.clickedButton).data("stepid");$("#step-"+stepId+"-completion-modules").val(values).trigger("change"),StepActivitySelector.prototype.loadList(),stepsave.rebindInputs(),popup.close()}.bind(this)),body.on("click",'[data-action="cancel"]',(function(){popup.close()}))},{init:function(){return new StepActivitySelector},rebindButtons:function(){StepActivitySelector.prototype.rebindButtons(),StepActivitySelector.prototype.rebindCheckbox(),StepActivitySelector.prototype.loadList()}}}));

//# sourceMappingURL=step_activity_select.min.js.map