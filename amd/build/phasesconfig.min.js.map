{"version":3,"sources":["../src/phasesconfig.js"],"names":["define","$","notification","templates","ec","LearningObjectivesConfig","RoadmapConfig","inputSelector","inputConfig","configContainer","showConfig","prototype","self","config","JSON","parse","val","render","then","html","js","prependNodeContents","refreshChecklists","click","e","addPhase","addCycle","addStep","collapsePhase","collapseCycle","collapseStep","fail","exception","event","preventDefault","stopPropagation","nextIndex","phases","length","newPhase","id","index","number","push","stringify","appendNodeContents","unbind","thisnode","currentTarget","phaseContainer","closest","cycleContainer","children","nextCycleIndex","stepsContainer","nextStepIndex","phaseWrapper","metadata","expandCollapse","cycleWrapper","init"],"mappings":"AAuBAA,OAAM,4BAAC,CAAC,QAAD,CAAW,mBAAX,CAAgC,gBAAhC,CAAkD,6BAAlD,CAAiF,sCAAjF,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAA0BC,CAA1B,CAAqCC,CAArC,CAAyCC,CAAzC,CAAmE,CAM/D,GAAIC,CAAAA,CAAa,CAAG,SAASC,CAAT,CAAwBC,CAAxB,CAAqC,CACrD,KAAKD,aAAL,CAAqBA,CAArB,CACA,KAAKE,eAAL,CAAuBR,CAAC,CAACO,CAAD,CAAxB,CAEA,KAAKE,UAAL,CAAgB,IAAhB,CACH,CALD,CAYAJ,CAAa,CAACK,SAAd,CAAwBD,UAAxB,CAAqC,UAAW,IACxCE,CAAAA,CAAI,CAAG,IADiC,CAExCC,CAAM,CAAGC,IAAI,CAACC,KAAL,CAAW,KAAKN,eAAL,CAAqBO,GAArB,EAAX,CAF+B,CAK5Cb,CAAS,CAACc,MAAV,CAAiB,kCAAjB,CAAqDJ,CAArD,EACKK,IADL,CACU,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACrBjB,CAAS,CAACkB,mBAAV,CAA8BT,CAAI,CAACL,aAAnC,CAAkDY,CAAlD,CAAwDC,CAAxD,EAEAf,CAAwB,CAACiB,iBAAzB,GAEArB,CAAC,CAAC,YAAD,CAAD,CAAgBsB,KAAhB,CAAsB,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBc,QAAxB,CAAiCD,CAAjC,CAAsC,CAA1E,EACAvB,CAAC,CAAC,kBAAD,CAAD,CAAsBsB,KAAtB,CAA4B,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBe,QAAxB,CAAiCF,CAAjC,CAAsC,CAAhF,EACAvB,CAAC,CAAC,iBAAD,CAAD,CAAqBsB,KAArB,CAA2B,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBgB,OAAxB,CAAgCH,CAAhC,CAAqC,CAA9E,EAEAvB,CAAC,CAAC,yBAAD,CAAD,CAA6BsB,KAA7B,CAAmC,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBiB,aAAxB,CAAsCJ,CAAtC,CAA2C,CAA5F,EACAvB,CAAC,CAAC,yBAAD,CAAD,CAA6BsB,KAA7B,CAAmC,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBkB,aAAxB,CAAsCL,CAAtC,CAA2C,CAA5F,EACAvB,CAAC,CAAC,wBAAD,CAAD,CAA4BsB,KAA5B,CAAkC,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBmB,YAAxB,CAAqCN,CAArC,CAA0C,CAA1F,CAEH,CAdL,EAcOO,IAdP,CAcY7B,CAAY,CAAC8B,SAdzB,CAeH,CApBD,CAsBA1B,CAAa,CAACK,SAAd,CAAwBc,QAAxB,CAAmC,SAASQ,CAAT,CAAgB,CAC/CA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GAF+C,GAG3CtB,CAAAA,CAAM,CAAGC,IAAI,CAACC,KAAL,CAAWd,CAAC,CAAC,sCAAD,CAAD,CAAwCe,GAAxC,EAAX,CAHkC,CAI3CoB,CAAS,CAAGvB,CAAM,CAACwB,MAAP,CAAcC,MAJiB,CAK3CC,CAAQ,CAAG,CAACC,EAAE,CAAE,CAAC,CAAN,CAASC,KAAK,CAAEL,CAAhB,CAA2BM,MAAM,CAAEN,CAAS,CAAC,CAA7C,CALgC,CAM/CvB,CAAM,CAACwB,MAAP,CAAcM,IAAd,CAAmBJ,CAAnB,EACAtC,CAAC,CAAC,sCAAD,CAAD,CAAwCe,GAAxC,CAA4CF,IAAI,CAAC8B,SAAL,CAAe/B,CAAf,CAA5C,EAEAV,CAAS,CAACc,MAAV,CAAiB,iCAAjB,CAAoDsB,CAApD,EACKrB,IADL,CACU,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACrBjB,CAAS,CAAC0C,kBAAV,CAA6B,kBAA7B,CAAiD1B,CAAjD,CAAuDC,CAAvD,EAEAnB,CAAC,CAAC,yBAAD,CAAD,CAA6B6C,MAA7B,CAAoC,OAApC,EACKvB,KADL,CACW,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBiB,aAAxB,CAAsCJ,CAAtC,CAA2C,CADpE,EAIAvB,CAAC,CAAC,YAAD,CAAD,CAAgB6C,MAAhB,CAAuB,OAAvB,EACKvB,KADL,CACW,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBc,QAAxB,CAAiCD,CAAjC,CAAsC,CAD/D,CAGH,CAXL,EAWOO,IAXP,CAWY7B,CAAY,CAAC8B,SAXzB,CAYH,CArBD,CAuBA1B,CAAa,CAACK,SAAd,CAAwBe,QAAxB,CAAmC,SAASO,CAAT,CAAgB,CAC/CA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GAF+C,GAG3CY,CAAAA,CAAQ,CAAG9C,CAAC,CAACgC,CAAK,CAACe,aAAP,CAH+B,CAI3CC,CAAc,CAAGF,CAAQ,CAACG,OAAT,CAAiB,kBAAjB,CAJ0B,CAK3CC,CAAc,CAAGF,CAAc,CAACG,QAAf,CAAwB,yBAAxB,CAL0B,CAO3CC,CAAc,CAAGF,CAAc,CAACC,QAAf,CAAwB,gBAAxB,EAA0Cd,MAPhB,CAU/CnC,CAAS,CAACc,MAAV,CAAiB,iCAAjB,CAFe,CAACuB,EAAE,CAAE,CAAC,CAAN,CAASC,KAAK,CAAEY,CAAhB,CAAgCX,MAAM,CAAEW,CAAc,CAAC,CAAvD,CAEf,EACKnC,IADL,CACU,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACrBjB,CAAS,CAAC0C,kBAAV,CAA6BM,CAA7B,CAA6ChC,CAA7C,CAAmDC,CAAnD,EAEAnB,CAAC,CAAC,yBAAD,CAAD,CAA6B6C,MAA7B,CAAoC,OAApC,EACKvB,KADL,CACW,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBkB,aAAxB,CAAsCL,CAAtC,CAA2C,CADpE,EAGAvB,CAAC,CAAC,iBAAD,CAAD,CAAqB6C,MAArB,CAA4B,OAA5B,EACKvB,KADL,CACW,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBgB,OAAxB,CAAgCH,CAAhC,CAAqC,CAD9D,CAGH,CAVL,EAUOO,IAVP,CAUY7B,CAAY,CAAC8B,SAVzB,CAWH,CArBD,CAuBA1B,CAAa,CAACK,SAAd,CAAwBgB,OAAxB,CAAkC,SAASM,CAAT,CAAgB,CAC9CA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GAF8C,GAG1CY,CAAAA,CAAQ,CAAG9C,CAAC,CAACgC,CAAK,CAACe,aAAP,CAH8B,CAI1CG,CAAc,CAAGJ,CAAQ,CAACG,OAAT,CAAiB,kBAAjB,CAJyB,CAK1CI,CAAc,CAAGH,CAAc,CAACC,QAAf,CAAwB,wBAAxB,CALyB,CAO1CG,CAAa,CAAGD,CAAc,CAACF,QAAf,CAAwB,eAAxB,EAAyCd,MAPf,CAU9CnC,CAAS,CAACc,MAAV,CAAiB,gCAAjB,CAFc,CAACuB,EAAE,CAAE,CAAC,CAAN,CAASC,KAAK,CAAEc,CAAhB,CAA+Bb,MAAM,CAAEa,CAAa,CAAC,CAArD,CAEd,EACKrC,IADL,CACU,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACrBjB,CAAS,CAAC0C,kBAAV,CAA6BS,CAA7B,CAA6CnC,CAA7C,CAAmDC,CAAnD,EAEAnB,CAAC,CAAC,wBAAD,CAAD,CAA4B6C,MAA5B,CAAmC,OAAnC,EACKvB,KADL,CACW,SAASC,CAAT,CAAY,CAAElB,CAAa,CAACK,SAAd,CAAwBmB,YAAxB,CAAqCN,CAArC,CAA0C,CADnE,CAGH,CAPL,EAOOO,IAPP,CAOY7B,CAAY,CAAC8B,SAPzB,CAQH,CAlBD,CAoBA1B,CAAa,CAACK,SAAd,CAAwBiB,aAAxB,CAAwC,SAASK,CAAT,CAAgB,CACpDA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GAFoD,GAGhDY,CAAAA,CAAQ,CAAG9C,CAAC,CAACgC,CAAK,CAACe,aAAP,CAHoC,CAIhDQ,CAAY,CAAGT,CAAQ,CAACG,OAAT,CAAiB,gBAAjB,CAJiC,CAKhDO,CAAQ,CAAGD,CAAY,CAACJ,QAAb,CAAsB,kBAAtB,CALqC,CAMpDhD,CAAE,CAACsD,cAAH,CAAkBD,CAAlB,CAA4BV,CAA5B,CACH,CAPD,CASAzC,CAAa,CAACK,SAAd,CAAwBkB,aAAxB,CAAwC,SAASI,CAAT,CAAgB,CACpDA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GAFoD,GAGhDY,CAAAA,CAAQ,CAAG9C,CAAC,CAACgC,CAAK,CAACe,aAAP,CAHoC,CAIhDW,CAAY,CAAGZ,CAAQ,CAACG,OAAT,CAAiB,gBAAjB,CAJiC,CAKhDO,CAAQ,CAAGE,CAAY,CAACP,QAAb,CAAsB,kBAAtB,CALqC,CAMpDhD,CAAE,CAACsD,cAAH,CAAkBD,CAAlB,CAA4BV,CAA5B,CACH,CAPD,CASAzC,CAAa,CAACK,SAAd,CAAwBmB,YAAxB,CAAuC,SAASG,CAAT,CAAgB,CACnDA,CAAK,CAACC,cAAN,GACAD,CAAK,CAACE,eAAN,GAFmD,GAG/CY,CAAAA,CAAQ,CAAG9C,CAAC,CAACgC,CAAK,CAACe,aAAP,CAHmC,CAI/CW,CAAY,CAAGZ,CAAQ,CAACG,OAAT,CAAiB,eAAjB,CAJgC,CAK/CO,CAAQ,CAAGE,CAAY,CAACP,QAAb,CAAsB,iBAAtB,CALoC,CAMnDhD,CAAE,CAACsD,cAAH,CAAkBD,CAAlB,CAA4BV,CAA5B,CACH,CAPD,CASA,MAAO,CASHa,IAAI,CAAE,cAASrD,CAAT,CAAwBC,CAAxB,CAAqC,CACvC,MAAO,IAAIF,CAAAA,CAAJ,CAAkBC,CAAlB,CAAiCC,CAAjC,CACV,CAXE,CAaV,CAnJC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the configuration of the roadmap.\n *\n * @module     mod_roadmap/roadmapconfig\n * @package    mod_roadmap\n * @copyright  2021 Steve Bader <smbader@ncsu.edu>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/notification', 'core/templates', 'mod_roadmap/expand_contract', 'mod_roadmap/learningobjectivesconfig'],\n    function($, notification, templates, ec, LearningObjectivesConfig) {\n\n        /**\n         * Learning objectives config object.\n         * @param {String} inputSelector The hidden input field selector.\n         */\n        var RoadmapConfig = function(inputSelector, inputConfig) {\n            this.inputSelector = inputSelector;\n            this.configContainer = $(inputConfig);\n\n            this.showConfig(this);\n        };\n\n        /**\n         * Displays the scale configuration dialogue.\n         *\n         * @method showConfig\n         */\n        RoadmapConfig.prototype.showConfig = function() {\n            var self = this;\n            var config = JSON.parse(this.configContainer.val());\n\n            // Dish up the form.\n            templates.render('mod_roadmap/configuration_phases', config)\n                .then(function(html, js) {\n                    templates.prependNodeContents(self.inputSelector, html, js);\n\n                    LearningObjectivesConfig.refreshChecklists();\n\n                    $('#add-phase').click(function(e) { RoadmapConfig.prototype.addPhase(e); });\n                    $('.add-phase-cycle').click(function(e) { RoadmapConfig.prototype.addCycle(e); });\n                    $('.add-cycle-step').click(function(e) { RoadmapConfig.prototype.addStep(e); });\n\n                    $('.phase-collapse-control').click(function(e) { RoadmapConfig.prototype.collapsePhase(e); });\n                    $('.cycle-collapse-control').click(function(e) { RoadmapConfig.prototype.collapseCycle(e); });\n                    $('.step-collapse-control').click(function(e) { RoadmapConfig.prototype.collapseStep(e); });\n\n                }).fail(notification.exception);\n        };\n\n        RoadmapConfig.prototype.addPhase = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var config = JSON.parse($('input[name=\"roadmapconfiguration\"]').val());\n            var nextIndex = config.phases.length;\n            var newPhase = {id: -1, index: nextIndex, number: nextIndex+1};\n            config.phases.push(newPhase);\n            $('input[name=\"roadmapconfiguration\"]').val(JSON.stringify(config));\n\n            templates.render('mod_roadmap/configuration_phase', newPhase)\n                .then(function(html, js) {\n                    templates.appendNodeContents('#phase-container', html, js);\n\n                    $('.phase-collapse-control').unbind('click')\n                        .click(function(e) { RoadmapConfig.prototype.collapsePhase(e); });\n\n\n                    $('#add-phase').unbind('click')\n                        .click(function(e) { RoadmapConfig.prototype.addPhase(e); });\n\n                }).fail(notification.exception);\n        };\n\n        RoadmapConfig.prototype.addCycle = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var thisnode = $(event.currentTarget);\n            var phaseContainer = thisnode.closest('.phase-container');\n            var cycleContainer = phaseContainer.children('.phase-cycles-container');\n\n            var nextCycleIndex = cycleContainer.children('.cycle-wrapper').length;\n            var newCycle = {id: -1, index: nextCycleIndex, number: nextCycleIndex+1};\n\n            templates.render('mod_roadmap/configuration_cycle', newCycle)\n                .then(function(html, js) {\n                    templates.appendNodeContents(cycleContainer, html, js);\n\n                    $('.cycle-collapse-control').unbind('click')\n                        .click(function(e) { RoadmapConfig.prototype.collapseCycle(e); });\n\n                    $('.add-cycle-step').unbind('click')\n                        .click(function(e) { RoadmapConfig.prototype.addStep(e); });\n\n                }).fail(notification.exception);\n        };\n\n        RoadmapConfig.prototype.addStep = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var thisnode = $(event.currentTarget);\n            var cycleContainer = thisnode.closest('.cycle-container');\n            var stepsContainer = cycleContainer.children('.cycle-steps-container');\n\n            var nextStepIndex = stepsContainer.children('.step-wrapper').length;\n            var newStep = {id: -1, index: nextStepIndex, number: nextStepIndex+1};\n\n            templates.render('mod_roadmap/configuration_step', newStep)\n                .then(function(html, js) {\n                    templates.appendNodeContents(stepsContainer, html, js);\n\n                    $('.step-collapse-control').unbind('click')\n                        .click(function(e) { RoadmapConfig.prototype.collapseStep(e); });\n\n                }).fail(notification.exception);\n        };\n\n        RoadmapConfig.prototype.collapsePhase = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var thisnode = $(event.currentTarget);\n            var phaseWrapper = thisnode.closest('.phase-wrapper');\n            var metadata = phaseWrapper.children('.phase-container');\n            ec.expandCollapse(metadata, thisnode);\n        };\n\n        RoadmapConfig.prototype.collapseCycle = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var thisnode = $(event.currentTarget);\n            var cycleWrapper = thisnode.closest('.cycle-wrapper');\n            var metadata = cycleWrapper.children('.cycle-container');\n            ec.expandCollapse(metadata, thisnode);\n        };\n\n        RoadmapConfig.prototype.collapseStep = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var thisnode = $(event.currentTarget);\n            var cycleWrapper = thisnode.closest('.step-wrapper');\n            var metadata = cycleWrapper.children('.step-container');\n            ec.expandCollapse(metadata, thisnode);\n        };\n\n        return {\n\n            /**\n             * Main initialisation.\n             *\n             * @param {String} inputSelector The hidden input field selector.\n             * @return {LearningObjectivesConfig} A new instance of PhasesConfig.\n             * @method init\n             */\n            init: function(inputSelector, inputConfig) {\n                return new RoadmapConfig(inputSelector, inputConfig);\n            }\n        };\n    });\n"],"file":"phasesconfig.min.js"}