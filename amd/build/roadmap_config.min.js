define ("mod_roadmap/roadmap_config",["jquery","core/notification","core/templates","mod_roadmap/expand_contract","mod_roadmap/learningobjectivesconfig","mod_roadmap/step_icon_select","mod_roadmap/step_activity_select","mod_roadmap/step_save","mod_roadmap/cycle_save","mod_roadmap/phase_save"],function(a,b,c,d,e,f,g,h,i,j){var k=function(b,c){this.inputSelector=b;this.configContainer=a(c);this.initForm()};k.prototype.initForm=function(){var d=this,l=this.configContainer.val();if(""==l){l=JSON.stringify({phases:[]});this.configContainer.val(l)}var m=JSON.parse(l),n=0,o=0,p=0;a.each(m.phases,function(b){var d=m.phases[b];n=n+1;d.id=n;d.number=b+1;d.index=b;d.configuration=JSON.stringify(d);a.each(d.cycles,function(b){var c=d.cycles[b];o=o+1;c.id=o;c.number=b+1;c.index=b;c.configuration=JSON.stringify(c);a.each(c.steps,function(a){var b=c.steps[a];p=p+1;b.id=p;b.number=a+1;b.index=a;b.configuration=JSON.stringify(b)})})});c.render("mod_roadmap/configuration_phases",m).then(function(b,l){c.prependNodeContents(d.inputSelector,b,l);a("#add-phase").click(function(a){k.prototype.addPhase(a)});a(".add-phase-cycle").click(function(a){k.prototype.addCycle(a)});a(".add-cycle-step").click(function(a){k.prototype.addStep(a)});a(".phase-collapse-control").click(function(a){k.prototype.collapsePhase(a)});a(".cycle-collapse-control").click(function(a){k.prototype.collapseCycle(a)});a(".step-collapse-control").click(function(a){k.prototype.collapseStep(a)});a(".phase-delete-control").click(function(a){k.prototype.deletePhase(a)});a(".cycle-delete-control").click(function(a){k.prototype.deleteCycle(a)});a(".step-delete-control").click(function(a){k.prototype.deleteStep(a)});a(".phase-up-control").click(function(a){k.prototype.upPhase(a)});a(".phase-down-control").click(function(a){k.prototype.downPhase(a)});a(".cycle-up-control").click(function(a){k.prototype.upCycle(a)});a(".cycle-down-control").click(function(a){k.prototype.downCycle(a)});a(".step-up-control").click(function(a){k.prototype.upStep(a)});a(".step-down-control").click(function(a){k.prototype.downStep(a)});e.refresh_checklists();f.rebind_buttons();g.rebind_buttons();h.rebind_inputs();i.rebind_inputs();j.rebind_inputs();k.prototype.bindConfigSave()}).fail(b.exception)};k.prototype.bindConfigSave=function(){a("input.phase-configuration").unbind("change").change(this.configSave.bind(this))};k.prototype.configSave=function(){var b=a("#phase-container"),c=[],d=0;a.each(b.find(".phase-wrapper .phase-configuration"),function(){var b=a(this).val();if(""==b){b="{}"}var e=JSON.parse(b);e.index=d;d=d+1;e.id=d;c.push(e)});a("input[name=\"roadmapconfiguration\"]").val(JSON.stringify({phases:c}))};k.prototype.addPhase=function(d){d.preventDefault();d.stopPropagation();var e=JSON.parse(a("input[name=\"roadmapconfiguration\"]").val()),f=e.phases.length,g={id:f+1,index:f,number:f+1};e.phases.push(g);a("input[name=\"roadmapconfiguration\"]").val(JSON.stringify(e));c.render("mod_roadmap/configuration_phase",g).then(function(b,d){c.appendNodeContents("#phase-container",b,d);a(".phase-collapse-control").unbind("click").click(function(a){k.prototype.collapsePhase(a)});a(".phase-delete-control").unbind("click").click(function(a){k.prototype.deletePhase(a)});a("#add-phase").unbind("click").click(function(a){k.prototype.addPhase(a)});a(".add-phase-cycle").unbind("click").click(function(a){k.prototype.addCycle(a)});j.rebind_inputs();k.prototype.bindConfigSave()}).fail(b.exception)};k.prototype.addCycle=function(d){d.preventDefault();d.stopPropagation();var f=a(d.currentTarget),g=f.closest(".phase-container"),h=g.children(".phase-cycles-container"),l=h.children(".cycle-wrapper").length,m=a(".phase-cycles-container > .cycle-wrapper").length;c.render("mod_roadmap/configuration_cycle",{id:m+1,index:l,number:l+1}).then(function(b,d){c.appendNodeContents(h,b,d);a(".cycle-collapse-control").unbind("click").click(function(a){k.prototype.collapseCycle(a)});a(".cycle-delete-control").unbind("click").click(function(a){k.prototype.deleteCycle(a)});a(".add-cycle-step").unbind("click").click(function(a){k.prototype.addStep(a)});e.refresh_checklists();i.rebind_inputs();j.rebind_inputs()}).fail(b.exception)};k.prototype.addStep=function(d){d.preventDefault();d.stopPropagation();var e=a(d.currentTarget),j=e.closest(".cycle-container"),l=j.children(".cycle-steps-container"),m=l.children(".step-wrapper").length,n=a(".step-wrapper").length,o=JSON.parse(a("input[name=\"datetimepickerdata\"]").val()),p={id:n+1,index:m,number:m+1,days:o.days,months:o.months,years:o.years,hours:o.hours,minutes:o.minutes,stepicon:"icon-10"};c.render("mod_roadmap/configuration_step",p).then(function(b,d){c.appendNodeContents(l,b,d);a(".step-collapse-control").unbind("click").click(function(a){k.prototype.collapseStep(a)});a(".step-delete-control").unbind("click").click(function(a){k.prototype.deleteStep(a)});f.rebind_buttons();g.rebind_buttons();h.rebind_inputs();i.rebind_inputs()}).fail(b.exception)};k.prototype.collapsePhase=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),e=c.closest(".phase-wrapper"),f=e.children(".phase-container");d.expandCollapse(f,c)};k.prototype.collapseCycle=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),e=c.closest(".cycle-wrapper"),f=e.children(".cycle-container");d.expandCollapse(f,c)};k.prototype.collapseStep=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),e=c.closest(".step-wrapper"),f=e.children(".step-container");d.expandCollapse(f,c)};k.prototype.deletePhase=function(b){b.preventDefault();b.stopPropagation();if(confirm("Are you sure you want to delete this Phase?")){var c=a(b.currentTarget),d=c.closest(".phase-wrapper");d.remove();k.prototype.configSave()}};k.prototype.deleteCycle=function(b){b.preventDefault();b.stopPropagation();if(confirm("Are you sure you want to delete this Cycle?")){var c=a(b.currentTarget),d=c.closest(".cycle-wrapper"),e=c.closest(".phase-container");d.remove();e.find(".phase-title").triggerHandler("change")}};k.prototype.deleteStep=function(b){b.preventDefault();b.stopPropagation();if(confirm("Are you sure you want to delete this Step?")){var c=a(b.currentTarget),d=c.closest(".step-wrapper"),e=c.closest(".cycle-container");d.remove();e.find(".cycle-title").triggerHandler("change")}};k.prototype.upPhase=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),d=c.closest(".phase-wrapper"),e=d.prev();d.insertBefore(e);k.prototype.configSave()};k.prototype.downPhase=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),d=c.closest(".phase-wrapper"),e=d.next();d.insertAfter(e);k.prototype.configSave()};k.prototype.upCycle=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),d=c.closest(".cycle-wrapper"),e=c.closest(".phase-container"),f=d.prev();if(f){d.insertBefore(f);e.find(".phase-title").triggerHandler("change")}};k.prototype.downCycle=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),d=c.closest(".cycle-wrapper"),e=c.closest(".phase-container"),f=d.next();if(f){d.insertAfter(f);e.find(".phase-title").triggerHandler("change")}};k.prototype.upStep=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),d=c.closest(".step-wrapper"),e=c.closest(".cycle-container"),f=d.prev();if(f){d.insertBefore(f);e.find(".cycle-title").triggerHandler("change")}};k.prototype.downStep=function(b){b.preventDefault();b.stopPropagation();var c=a(b.currentTarget),d=c.closest(".step-wrapper"),e=c.closest(".cycle-container"),f=d.next();if(f){d.insertAfter(f);e.find(".cycle-title").triggerHandler("change")}};return{init:function init(a,b){return new k(a,b)}}});
//# sourceMappingURL=roadmap_config.min.js.map
