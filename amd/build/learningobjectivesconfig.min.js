/**
 * Handle the configuration of learning objectives.
 *
 * @module     mod_roadmap/learningobjectivesconfig
 * @copyright  2021 Steve Bader <smbader@ncsu.edu>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_roadmap/learningobjectivesconfig",["jquery","core/notification","core/templates","mod_roadmap/cycle_save"],(function($,notification,templates,cyclesave){var LearningObjectivesConfig=function(inputSelector,inputConfig){this.inputSelector=$(inputSelector).parent(),this.configContainer=$(inputConfig),this.showConfig(this)};return LearningObjectivesConfig.prototype.showConfig=function(){var self=this,inputConfigVal=this.configContainer.val();""==inputConfigVal&&(inputConfigVal=JSON.stringify({learningobjectives:[]}),this.configContainer.val(inputConfigVal));var config=JSON.parse(inputConfigVal);config.learningobjectives.forEach((function(learningobjective){learningobjective.number=learningobjective.index+1})),templates.render("mod_roadmap/configuration_learningobjectives",config).then((function(html,js){templates.prependNodeContents(self.inputSelector,html,js),$("#add-learning-objective").click((function(e){e.preventDefault();var nextloIndex=$("#learningobjective-container").children(".learningobjective").length,newLo={id:nextloIndex,number:nextloIndex+1};templates.render("mod_roadmap/configuration_learningobjective",newLo).then((function(html,js){templates.appendNodeContents("#learningobjective-container",html,js),LearningObjectivesConfig.prototype.rebindInputs(),LearningObjectivesConfig.prototype.saveConfig()})).fail(notification.exception)})),LearningObjectivesConfig.prototype.rebindInputs()})).fail(notification.exception)},LearningObjectivesConfig.prototype.rebindInputs=function(){$(".learning-objective-name").unbind("change").change((function(){LearningObjectivesConfig.prototype.saveConfig()})),$(".learningobjective-delete-control").unbind("click").click((function(e){LearningObjectivesConfig.prototype.deleteLearningObjective(e)})),$(".learningobjective-up-control").unbind("click").click((function(e){LearningObjectivesConfig.prototype.upLearningObjective(e)})),$(".learningobjective-down-control").unbind("click").click((function(e){LearningObjectivesConfig.prototype.downLearningObjective(e)}))},LearningObjectivesConfig.prototype.saveConfig=function(){var arrlo=[];$("#learningobjective-container").children(".learningobjective").each((function(index){let lonode=$("#learningobjective-container").children(".learningobjective")[index],id=$(lonode).data("id"),name=$(lonode).find("input.learning-objective-name").val();arrlo.push({index:index,id:id,name:name})})),$("#id_learningobjectivesconfiguration").val(JSON.stringify({learningobjectives:arrlo})),LearningObjectivesConfig.prototype.refreshChecklists(),cyclesave.rebind_inputs(),$('.chk-learning-objectives input[type="checkbox"]').trigger("change")},LearningObjectivesConfig.prototype.refreshChecklists=function(){var config=JSON.parse($("#id_learningobjectivesconfiguration").val()),chkAreas=$(".chk-learning-objectives");$(chkAreas).each((function(i,e){let selectedIds=[],configVal=$(this).closest(".cycle-container").children(".cycle-configuration").val();if(""!=configVal){let stepConfig=JSON.parse(configVal);stepConfig.learningobjectives||(stepConfig.learningobjectives=""),selectedIds=stepConfig.learningobjectives.split(",").map((x=>parseInt(x)))}$(e).empty(),config.learningobjectives.forEach((function(learningobjective){var li=$("<li/>").attr("data-id",learningobjective.id).appendTo($(e));$("<input/>").attr("type","checkbox").attr("value",learningobjective.id).attr("class","form-control").attr("checked",$.inArray(learningobjective.id,selectedIds)>=0).appendTo(li),$("<span>").text(" "+learningobjective.name).appendTo(li)}))}))},LearningObjectivesConfig.prototype.deleteLearningObjective=function(event){(event.preventDefault(),event.stopPropagation(),confirm("Are you sure you want to delete this Learning Objective?"))&&($(event.currentTarget).closest(".learningobjective").remove(),LearningObjectivesConfig.prototype.saveConfig())},LearningObjectivesConfig.prototype.upLearningObjective=function(event){event.preventDefault(),event.stopPropagation();var loItem=$(event.currentTarget).closest(".learningobjective"),prevloItem=loItem.prev();loItem.insertBefore(prevloItem),LearningObjectivesConfig.prototype.saveConfig()},LearningObjectivesConfig.prototype.downLearningObjective=function(event){event.preventDefault(),event.stopPropagation();var loItem=$(event.currentTarget).closest(".learningobjective"),nextloItem=loItem.next();loItem.insertAfter(nextloItem),LearningObjectivesConfig.prototype.saveConfig()},{init:function(inputSelector,inputConfig){return new LearningObjectivesConfig(inputSelector,inputConfig)},refresh_checklists:function(){LearningObjectivesConfig.prototype.refreshChecklists()}}}));

//# sourceMappingURL=learningobjectivesconfig.min.js.map