{"version":3,"file":"cycle_save.min.js","sources":["../src/cycle_save.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the saving of cycle data and rebinding of inputs.\n *\n * @module     mod_roadmap/cycle_save\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    /**\n     * CycleSave class handles saving and rebinding for roadmap cycles.\n     * @class\n     */\n    class CycleSave {\n        /**\n         * Rebinds all inputs related to cycle and attaches save handlers.\n         */\n        rebindInputs() {\n            $('.cycle-title').off('change').on('change', this.saveCycle.bind(this));\n            $('.cycle-subtitle').off('change').on('change', this.saveCycle.bind(this));\n            $('.cycle-pagelink').off('change').on('change', this.saveCycle.bind(this));\n            $('.chk-learning-objectives input[type=\"checkbox\"]')\n                .off('change').on('change', this.saveCycle.bind(this));\n            $('.cycle-steps-container .step-wrapper .step-configuration')\n                .off('change').on('change', this.saveCycle.bind(this));\n            // Initial save for all cycles (for new fields added)\n            $('.cycle-container').each((_, el) => {\n                this.saveCycle({target: el});\n            });\n        }\n\n        /**\n         * Saves the cycle data to its hidden config input.\n         * @param {Event|Object} event Event or jQuery-wrapped element reference.\n         */\n        saveCycle(event) {\n            // Support both event and direct call with element\n            const cycleContainer = $(event.target).closest('.cycle-container');\n            const cycleLos = [];\n            cycleContainer.find('.chk-learning-objectives input[type=\"checkbox\"]').each(function() {\n                if ($(this).prop(\"checked\")) {\n                    cycleLos.push($(this).val());\n                }\n            });\n\n            const cycleSteps = [];\n            cycleContainer.find('.cycle-steps-container .step-wrapper .step-configuration').each(function() {\n                let stepData = $(this).val() || '{}';\n                cycleSteps.push(JSON.parse(stepData));\n            });\n\n            const title = cycleContainer.find('.fitem input.cycle-title').val();\n            const cycleData = {\n                id: cycleContainer.closest('.cycle-wrapper').data('cycleid'),\n                title: title,\n                subtitle: cycleContainer.find('.fitem input.cycle-subtitle').val(),\n                pagelink: cycleContainer.find('.fitem input.cycle-pagelink').val(),\n                learningobjectives: cycleLos.join(\",\"),\n                steps: cycleSteps,\n            };\n\n            cycleContainer.closest('.cycle-wrapper').find('.cycle-header-title').html(title);\n            cycleContainer.children('input.cycle-configuration')\n                .val(JSON.stringify(cycleData))\n                .triggerHandler(\"change\");\n        }\n    }\n\n    // AMD export\n    const instance = new CycleSave();\n    return {\n        /**\n         * Initialize CycleSave (returns instance).\n         * @returns {CycleSave}\n         */\n        init: function() {\n            return instance;\n        },\n        /**\n         * Rebinds all cycle input handlers.\n         */\n        rebindInputs: function() {\n            instance.rebindInputs();\n        }\n    };\n});"],"names":["define","$","instance","rebindInputs","off","on","this","saveCycle","bind","each","_","el","target","event","cycleContainer","closest","cycleLos","find","prop","push","val","cycleSteps","stepData","JSON","parse","title","cycleData","id","data","subtitle","pagelink","learningobjectives","join","steps","html","children","stringify","triggerHandler","init"],"mappings":";;;;;;AAqBAA,gCAAO,CAAC,WAAW,SAASC,SA6DlBC,SAAW,UApDbC,eACIF,EAAE,gBAAgBG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OACjEL,EAAE,mBAAmBG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OACpEL,EAAE,mBAAmBG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OACpEL,EAAE,mDACGG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OACpDL,EAAE,4DACGG,IAAI,UAAUC,GAAG,SAAUC,KAAKC,UAAUC,KAAKF,OAEpDL,EAAE,oBAAoBQ,MAAK,CAACC,EAAGC,WACtBJ,UAAU,CAACK,OAAQD,QAQhCJ,UAAUM,aAEAC,eAAiBb,EAAEY,MAAMD,QAAQG,QAAQ,oBACzCC,SAAW,GACjBF,eAAeG,KAAK,mDAAmDR,MAAK,WACpER,EAAEK,MAAMY,KAAK,YACbF,SAASG,KAAKlB,EAAEK,MAAMc,gBAIxBC,WAAa,GACnBP,eAAeG,KAAK,4DAA4DR,MAAK,eAC7Ea,SAAWrB,EAAEK,MAAMc,OAAS,KAChCC,WAAWF,KAAKI,KAAKC,MAAMF,oBAGzBG,MAAQX,eAAeG,KAAK,4BAA4BG,MACxDM,UAAY,CACdC,GAAIb,eAAeC,QAAQ,kBAAkBa,KAAK,WAClDH,MAAOA,MACPI,SAAUf,eAAeG,KAAK,+BAA+BG,MAC7DU,SAAUhB,eAAeG,KAAK,+BAA+BG,MAC7DW,mBAAoBf,SAASgB,KAAK,KAClCC,MAAOZ,YAGXP,eAAeC,QAAQ,kBAAkBE,KAAK,uBAAuBiB,KAAKT,OAC1EX,eAAeqB,SAAS,6BACnBf,IAAIG,KAAKa,UAAUV,YACnBW,eAAe,kBAMrB,CAKHC,KAAM,kBACKpC,UAKXC,aAAc,WACVD,SAASC"}